<div class="page-container">
	<div class="pageheader">
		<div class="headercontent">
			<div class="section-container">
				<h2 class="title">Publications and preprints</h2>
				<div class="row">
					<div class="col-md-12">
						<p></p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="pagecontents">
		<div class="section color-1" id="filters">
			<div class="section-container">
				<div class="row">
					<div class="col-md-3">
						<h3>Filter by type:</h3>
					</div>
					<div class="col-md-6">
						<select id="cd-dropdown" name="cd-dropdown" class="cd-select">
							<option class="filter" value="all" selected>All types</option>
							<option class="filter" value="jpaper">Articles</option>
							<option class="filter" value="thesis">Thesis</option>
							<!--<option class="filter" value="cpaper">Conference Papers</option>-->
						<!--	<option class="filter" value="bookchapter">Book Chapters</option> -->
							<!--<option class="filter" value="book">Books</option>-->
							<option class="filter" value="preprint">Preprints and work in progress</option>
						<!--<option class="filter" value="tpaper">Technical Papers</option> -->
						</select>
					</div>
					<div class="col-md-3" id="sort">
						<span>Sort by year:<span>
						<div class="btn-group pull-right"> 
							<button type="button" data-sort="data-year" data-order="desc" class="sort btn btn-default"><i class="fa fa-sort-numeric-asc"></i></button>
							<button type="button" data-sort="data-year" data-order="asc" class="sort btn btn-default"><i class="fa fa-sort-numeric-desc"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="section color-2" id="pub-grid">
			<div class="section-container">
				<div class="row">
					<div class="col-md-12">
						<div class="pitems" id="publications-list">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--BibTEX Parser-->
<script src="https://cdn.jsdelivr.net/npm/bibtex-parser@1.0.0/parse-bibtex.min.js"></script>

<script>
fetch('files/pages/publications.bib')
  .then(response => response.text())
  .then(bibtex => {
    const entries = bibtexParse.toJSON(bibtex);
    const container = document.getElementById('publications-list');
    entries.forEach(entry => {
      const type = entry.entryType;
      const fields = entry.entryTags;
      const title = fields.title || '';
      const author = fields.author || '';
      const year = fields.year || '';
      const month = fields.month || '';
      const pages = fields.pages || '';
      const pdf = fields.pdf || '';
      const pdf2 = fields.pdf2 || '';
      const doi = fields.doi || '';
      const abstract = fields.abstract || '';
      const funding = fields.funding || '';
      let labelcolor = '';
      let clase = '';
      let cite = '';
      if(type === "article"){
        labelcolor = 'success';
        clase = 'jpaper';
        cite = `${fields.journal || ''} <strong>${fields.volume || ''}</strong> (${year}), ${pages}.`;
      } else if(type === "book"){
        labelcolor = 'primary';
        clase = 'book';
        cite = `${fields.publisher || ''} (${year}), ${pages}.`;
      } else if(type === "preprint"){
        labelcolor = 'danger';
        clase = 'preprint';
        cite = `${fields.note || ''} (${year}).`;
      } else if(type === "thesis"){
        labelcolor = 'warning';
        clase = 'thesis';
        cite = `${fields.school || ''}, ${pages} pages. ${fields.note || ''}.`;
      } else {
        labelcolor = 'info';
      }
      let assets = '';
      if(abstract){
        assets += `<a href="#" class="pubcollapse"><i class="fa fa-plus"></i></a>`;
      }
      if(doi){
        assets += `<a href="${doi}" class="tooltips" target="_blank" title="Published version"><i class="fa fa-external-link"></i></a>`;
      }
      if(pdf){
        assets += `<a href="files/preprints/${pdf}" class="tooltips" target="_blank" title="Download preprint"><i class="fa fa-file-pdf-o"></i></a>`;
      }
      if(pdf2){
        assets += `<a href="files/preprints/${pdf2}" class="tooltips" target="_blank" title="Download addendum"><i class="fa fa-file-pdf-o"></i></a>`;
      }
      let fundingText = funding ? ` Partially funded by ${funding}.` : '';
      let abstractHtml = abstract ? `<div class="pubdetails"><h4>Abstract</h4><p>${abstract}</p></div>` : '';
      container.innerHTML += `
        <div class="item mix ${clase} mix_all" data-year="${year}" style="display: block; opacity: 1;">
          <div class="pubmain">
            <div class="pubassets">${assets}</div>
            <h4 class="pubtitle"><em>${title}</em></h4>
            <div class="pubauthor">${author}</div>
            <div class="pubcite">
              <span class="label label-${labelcolor}">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
              ${cite}${fundingText}
            </div>
          </div>
          ${abstractHtml}
        </div>
      `;
    });
  });
</script>